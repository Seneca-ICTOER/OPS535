"use strict";(self.webpackChunkOPS535=self.webpackChunkOPS535||[]).push([[1286],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},l=Object.keys(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=o.createContext({}),s=function(e){var t=o.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=s(e.components);return o.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,u=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=s(n),h=r,d=m["".concat(u,".").concat(h)]||m[h]||p[h]||l;return n?o.createElement(d,a(a({ref:t},c),{},{components:n})):o.createElement(d,a({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,a=new Array(l);a[0]=m;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:r,a[1]=i;for(var s=2;s<l;s++)a[s]=n[s];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9124:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return a},default:function(){return p},frontMatter:function(){return l},metadata:function(){return i},toc:function(){return s}});var o=n(3117),r=(n(7294),n(3905));const l={id:"vls2vls-routing",title:"VLS2VLS Routing",sidebar_position:20,description:"VLS2VLS Routing"},a="VLS2VLS Routing",i={unversionedId:"C-ExtraResources/vls2vls-routing",id:"C-ExtraResources/vls2vls-routing",title:"VLS2VLS Routing",description:"VLS2VLS Routing",source:"@site/docs/C-ExtraResources/vls2vls-routing.md",sourceDirName:"C-ExtraResources",slug:"/C-ExtraResources/vls2vls-routing",permalink:"/OPS535/C-ExtraResources/vls2vls-routing",draft:!1,editUrl:"https://github.com/Seneca-ICTOER/OERTemplate/tree/main/docs/C-ExtraResources/vls2vls-routing.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{id:"vls2vls-routing",title:"VLS2VLS Routing",sidebar_position:20,description:"VLS2VLS Routing"},sidebar:"courseNotesSidebar",previous:{title:"Ansible Setup",permalink:"/OPS535/C-ExtraResources/ansible-setup"},next:{title:"Startup script with systemd",permalink:"/OPS535/C-ExtraResources/startup-script-with-systemd"}},u={},s=[{value:"Background Information",id:"background-information",level:2},{value:"Virtual LAN Segment setting",id:"virtual-lan-segment-setting",level:2},{value:"VLS 1",id:"vls-1",level:2},{value:"VLS 2",id:"vls-2",level:2},{value:"VLS 3",id:"vls-3",level:2},{value:"Manually configure custom routes on the gateways to reach VMs in other VLSs",id:"manually-configure-custom-routes-on-the-gateways-to-reach-vms-in-other-vlss",level:2},{value:"On VLS 1",id:"on-vls-1",level:3},{value:"On VLS 2",id:"on-vls-2",level:3},{value:"On VLS 3",id:"on-vls-3",level:3},{value:"Manually Configure routes on each VM in each VLS",id:"manually-configure-routes-on-each-vm-in-each-vls",level:2},{value:"VLS 1 VM2 to VM4",id:"vls-1-vm2-to-vm4",level:3},{value:"VLS 2 VM2 to VM4",id:"vls-2-vm2-to-vm4",level:3},{value:"VLS 3 VM2 to VM4",id:"vls-3-vm2-to-vm4",level:3},{value:"Automate the process using BASH script",id:"automate-the-process-using-bash-script",level:2},{value:"Shell Script for adding custom routes on your gateway to other&#39;s VLSs",id:"shell-script-for-adding-custom-routes-on-your-gateway-to-others-vlss",level:2}],c={toc:s};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"vls2vls-routing"},"VLS2VLS Routing"),(0,r.kt)("h2",{id:"background-information"},"Background Information"),(0,r.kt)("p",null,"The following configuration may be used to set up the proper routes between private Virtual LAN Segments (VLS) in OPS535 Virtual Lab on CentOS 8.x virtual machines. The custom routes added to the gateway VM (VM1), and their corresponding VMs (VM2 to VM4) in their private VLS will enable VMs in each private VLS to communicate with VMs in the other private VLS."),(0,r.kt)("h2",{id:"virtual-lan-segment-setting"},"Virtual LAN Segment setting"),(0,r.kt)("p",null,"Consider three VLSs (one for each student) where there are 3 gateways, one for each VLS in the OPS535 virtual lab:"),(0,r.kt)("h2",{id:"vls-1"},"VLS 1"),(0,r.kt)("p",null,"VLS network: 192.168.1.0/24"),(0,r.kt)("p",null,"Gateway (Host) IPs: Internal (ens224): 192.168.1.1 External (ens192): 172.20.1.1"),(0,r.kt)("p",null,"VMs IPs:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"VM2: 192.168.1.2"),(0,r.kt)("li",{parentName:"ul"},"VM3: 192.168.1.3"),(0,r.kt)("li",{parentName:"ul"},"VM4: 192.168.1.4")),(0,r.kt)("p",null,"Default gateway on each VM2: 172.20.255.1 Gateway to the 192.168.0.0/16 network: 192.168.1.1"),(0,r.kt)("h2",{id:"vls-2"},"VLS 2"),(0,r.kt)("p",null,"VLS network: 192.168.2.0/24"),(0,r.kt)("p",null,"Gateway (Host) IPs: Internal (ens224): 192.168.2.1 External (ens192): 172.20.2.1"),(0,r.kt)("p",null,"VMs IPs:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"VM2: 192.168.2.2"),(0,r.kt)("li",{parentName:"ul"},"VM3: 192.168.2.3"),(0,r.kt)("li",{parentName:"ul"},"VM4: 192.168.2.4")),(0,r.kt)("p",null,"Default gateway on each VM2: 172.20.255.1 Gateway to the 192.168.0.0/16 network: 192.168.2.1"),(0,r.kt)("h2",{id:"vls-3"},"VLS 3"),(0,r.kt)("p",null,"VLS network: 192.168.3.0/24"),(0,r.kt)("p",null,"Gateway (Host) IPs: Internal (ens224): 192.168.3.1 External (ens192): 172.20.3.1"),(0,r.kt)("p",null,"VMs IPs:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"VM2: 192.168.3.2"),(0,r.kt)("li",{parentName:"ul"},"VM3: 192.168.3.3"),(0,r.kt)("li",{parentName:"ul"},"VM4: 192.168.3.4")),(0,r.kt)("p",null,"Default gateway on each VM2: 172.20.255.1 Gateway to the 192.168.0.0/16 network: 192.168.3.1"),(0,r.kt)("h2",{id:"manually-configure-custom-routes-on-the-gateways-to-reach-vms-in-other-vlss"},"Manually configure custom routes on the gateways to reach VMs in other VLSs"),(0,r.kt)("p",null,"You only need to create the custom routes on your own VLS, but make sure that other student's VLS has the custom routes to your VLS."),(0,r.kt)("h3",{id:"on-vls-1"},"On VLS 1"),(0,r.kt)("p",null,"On VLS 1's gateway (192.168.1.1 or 172.20.1.1): Using nmcli:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'nmcli con modify ens192 +ipv4.routes "192.168.2.0/24 172.20.2.1 100"'),(0,r.kt)("li",{parentName:"ul"},'nmcli con modify ens192 +ipv4.routes "192.168.3.0/24 172.20.3.1 100"'),(0,r.kt)("li",{parentName:"ul"},"nmcli con down ens192"),(0,r.kt)("li",{parentName:"ul"},"nmcli con up ens192")),(0,r.kt)("p",null,"Check to make sure that your kernel routing table has the proper entries with the following command:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ip route show")),(0,r.kt)("h3",{id:"on-vls-2"},"On VLS 2"),(0,r.kt)("p",null,"On VLS 2's gateway (192.168.2.1 or 172.20.2.1): Using nmcli:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'nmcli con modify ens192 +ipv4.routes "192.168.1.0/24 172.20.1.1 100"'),(0,r.kt)("li",{parentName:"ul"},'nmcli con modify ens192 +ipv4.routes "192.168.3.0/24 172.20.3.1 100"'),(0,r.kt)("li",{parentName:"ul"},"nmcli con down ens192"),(0,r.kt)("li",{parentName:"ul"},"nmcli con up ens192")),(0,r.kt)("p",null,"Check to make sure that your kernel routing table has the proper entries with the following command:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ip route show")),(0,r.kt)("h3",{id:"on-vls-3"},"On VLS 3"),(0,r.kt)("p",null,"On VLS 3's gateway (192.168.3.1 or 172.20.3.1): Using nmcli:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'nmcli con modify ens192 +ipv4.routes "192.168.1.0/24 172.20.1.1 100"'),(0,r.kt)("li",{parentName:"ul"},'nmcli con modify ens192 +ipv4.routes "192.168.2.0/24 172.20.2.1 100"'),(0,r.kt)("li",{parentName:"ul"},"nmcli con down ens192"),(0,r.kt)("li",{parentName:"ul"},"nmcli con up ens192")),(0,r.kt)("p",null,"Check to make sure that your kernel routing table has the proper entries with the following command:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ip route show")),(0,r.kt)("h2",{id:"manually-configure-routes-on-each-vm-in-each-vls"},"Manually Configure routes on each VM in each VLS"),(0,r.kt)("p",null,"You only need to create the custom routes on the VM in your VLS, but make sure that other students have proper routes on their VMs as well."),(0,r.kt)("h3",{id:"vls-1-vm2-to-vm4"},"VLS 1 VM2 to VM4"),(0,r.kt)("p",null,"On VLS 1's VM (192.168.1.2 .. 192.168.1.4)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'nmcli con modify ens224 +ipv4.routes "192.168.0.0/16 192.168.1.1 100"'),(0,r.kt)("li",{parentName:"ul"},"nmcli con down ens224"),(0,r.kt)("li",{parentName:"ul"},"nmcli con up ens224"),(0,r.kt)("li",{parentName:"ul"},"ip route show")),(0,r.kt)("h3",{id:"vls-2-vm2-to-vm4"},"VLS 2 VM2 to VM4"),(0,r.kt)("p",null,"On VLS 2's VM (192.168.2.2 .. 192.168.2.4)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'nmcli con modify ens224 +ipv4.routes "192.168.0.0/16 192.168.2.1 100"'),(0,r.kt)("li",{parentName:"ul"},"nmcli con down ens224"),(0,r.kt)("li",{parentName:"ul"},"nmcli con up ens224"),(0,r.kt)("li",{parentName:"ul"},"ip route show")),(0,r.kt)("h3",{id:"vls-3-vm2-to-vm4"},"VLS 3 VM2 to VM4"),(0,r.kt)("p",null,"On VLS 3's VM (192.168.3.2 .. 192.168.3.4)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'nmcli con modify ens224 +ipv4.routes "192.168.0.0/16 192.168.3.1 100"'),(0,r.kt)("li",{parentName:"ul"},"nmcli con down ens224"),(0,r.kt)("li",{parentName:"ul"},"nmcli con up ens224"),(0,r.kt)("li",{parentName:"ul"},"ip route show")),(0,r.kt)("h2",{id:"automate-the-process-using-bash-script"},"Automate the process using BASH script"),(0,r.kt)("p",null,'The above example shows that 2 custom routes on each VLS are needed to provides the proper routing to reach 2 other VLS on the your gateway (VM1). It will be quite time consuming to manage all the routes if the number of VLS is much greater (how about 40 VLSs?). The following script will be more practical if your need to set up all the necessary routes for a large number of VLSs. Both scripts use the shell environment variables "MY',"_","VLS","_",'NO" and "OTHER',"_","VLS","_",'NOS" to allow customization for different values of VLSs.'),(0,r.kt)("h2",{id:"shell-script-for-adding-custom-routes-on-your-gateway-to-others-vlss"},"Shell Script for adding custom routes on your gateway to other's VLSs"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"set the shell variable MY","_","VLS","_","NO to your assigned network ID (I use 2 here as an example, please change 2 to your assigned network ID)")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export MY_VLS_NO=2\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"edit the shell variable OTHER","_","VLS","_","NOS to the list of VLS you want to have a route to their VLS network. The following example assign the list of network numbers 1 to 43 that you want to create a custom route on your gateway.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"   OTHER_VLS_NOS=`seq 1 43`\n")),(0,r.kt)("p",null,"The following Bash script to add 42 new custom routes to your gateway VM's routing table:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'#! /bin/bash\nif [ -z "$MY_VLS_NO" ]\nthen\n    echo "Please run the following command to assign your network number" >&2\n    echo "to the shell varible MY_VLS_NO and run this script again." >&2\n    echo "Please replace xx with your actual network number." >&2\n    echo "  export MY_VLS_NO=xx" >&2\n    exit 1\nfi\nX=${MY_VLS_NO}\necho "Your Network Number is $X"\n\n# change the following variable if necessary\nOTHER_VLS_NOS=`seq 1 43`\n\nY=`echo ${OTHER_VLS_NOS}`\necho "Route to be added for the network number(s) $Y"\necho -n "Press ENTER to continue ... "\nread dummy\n\n# Add new route\nfor y in $Y\ndo\n    if [ "$X" -ne "$y" ]\n    then\n        nmcli con modify ens192 +ipv4.routes "192.168.${y}.0/24 172.20.${y}.1 100"\n        echo "Adding route to 192.168.${y}.0 network." \n    fi\ndone\nnmcli con down ens192\nnmcli con up ens192\nip route show\n \n# enable IP forwarding on the gateway, add "net.ipv4.ip_forward = 1" to /etc/sysctl.conf \necho "1" > /proc/sys/net/ipv4/ip_forward\n')))}p.isMDXComponent=!0}}]);